---
title: How to detect fileless malware in Microsoft 365 Defender
description: Investigate and respond to memory-based attacks, also known as fileless malware. 
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords: 
  - NOCSH
author: dansimp
ms.author: dansimp
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection: 
  - M365-security-compliance
  - m365solution-scenario
  - m365solution-evalutatemtp
ms.topic: conceptual
ms.technology: m365d
---

# How to detect fileless malware in Microsoft 365 Defender

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]

[!INCLUDE [Prerelease](../includes/prerelease.md)]

**Applies to:**

- Microsoft 365 Defender

As the threat landscape evolves, there's a rise in evasive memory-based attacks, also known as, fileless attacks. This shift in attacker techniques requires security tools to improve and hunt threats more effectively.

As antivirus solutions become better and better at pinpointing malicious files, the natural evolution of malware is to shift to attack chains that use as few files as possible. While fileless techniques used to be employed almost exclusively in sophisticated cyberattacks, they are now becoming widespread in common malware, too.

Microsoft actively monitors the security landscape to identify new threat trends and develop solutions that continuously enhance security and mitigate classes of threats. Through AMSI, behavior monitoring, memory scanning, and boot sector protection, threats can be detected even with heavy obfuscation. Machine learning technologies in the cloud also help scale these protections against new and emerging threats.

## Fileless threats

What exactly are fileless threats? The term "fileless" suggests that a threat doesn't come in a file, such as a backdoor that lives only in the memory of a machine. However, there's no single definition for fileless malware. The term is used broadly, and sometimes to describe malware families that do rely on files to operate.

Attacks generally involve several stages for functionalities like execution, persistence, or information theft. Some parts of the attack chain may be fileless, while others may involve the file system in some form.

For more information, see [Fileless threats](/windows/security/threat-protection/intelligence/fileless-threats).

## Defeat fileless malware with next-gen antivirus protection

File-based inspection is ineffective against fileless malware. Antivirus capabilities in Microsoft 365 Defender use defensive layers based on dynamic behavior and integrate with other Windows technologies to detect and terminate threat activity at runtime.

Microsoft 365 Defender’s next-gen dynamic defenses is of paramount importance in protecting customers from the increasingly sophisticated attacks that fileless malware causes. Evolving from the file-centric scanning model, Microsoft 365 Defender uses a generic and more powerful behavior-centric detection model to neutralize generic malicious behaviors, and thus take out entire classes of attack.

### Antimalware Scan Interface (AMSI)

AMSI is an open framework that applications can use to request antivirus scans of any data. Windows uses AMSI extensively in JavaScript, VBScript, and PowerShell, enabling antivirus and other security solutions to scan macros and other scripts at runtime to check for malicious behavior. 

Microsoft 365 Defender integrates with AMSI and consumes all AMSI signals for protection. It leads to the disruption of malware campaigns like Nemucod. 

During a recent investigation, malicious scripts that were heavily obfuscated were detected. Three samples were then collected that were evading static signatures and are a mixture of barely recognizable script code and binary junk data. However, after manual de-obfuscation, it turned out that these samples decode and execute the same .js script payload, a known downloader.

The payload does not have any obfuscation and is easy to detect, but it never touches the disk and so could evade file-based detection. However, the scripting engine is capable of intercepting the attempt to execute the decoded payload and ensuring that the payload is passed to the installed antivirus via AMSI for inspection. Microsoft 365 Defender has visibility on the real payload as it’s decoded at runtime and can easily recognize known patterns and block the attack before it can cause any damage.

Instead of writing a generic detection algorithm based on the obfuscation patterns in the samples, a machine learning model on this behavior log was created to catch the decrypted scripts inspected via AMSI. The results proved effective, catching new and unknown variants, protecting almost two thousand machines in a span of two months. Traditional detection would not have been as effective.

### Behavior monitoring

Microsoft 365 Defender’s behavior monitoring engine provides an additional layer of antivirus protection against fileless malware. The behavior monitoring engine filters suspicious API calls. Detection algorithms can then match dynamic behaviors that use particular sequences of APIs with specific parameters and block processes that expose known malicious behaviors. Behavior monitoring is useful not only for fileless malware, but also for traditional malware where the same malicious code base gets continuously repacked, encrypted, or obfuscated. Behavior monitoring proved effective against WannaCry, which was distributed through the DoublePulsar backdoor and can be categorized as a dangerous Type I fileless malware. While several variants of the WannaCry binaries were released in attack waves, the behavior of the ransomware remained the same, allowing antivirus capabilities to block new versions of the ransomware.

Behavior monitoring is useful against fileless attacks that live off the land. The PowerShell reverse TCP payload can be run completely on a command line and can provide a PowerShell session to a remote attacker.

There’s no file to scan in this attack, but through behavior monitoring in its antivirus capabilities, Microsoft 365 Defender can detect the creation of the PowerShell process with the particular command line required. Behavior monitoring detects and blocks numerous attacks like this on a daily basis.

### Memory scanning

Antivirus capabilities in Microsoft 365 Defender also employ memory scanning to detect the presence of malicious code in the memory of a running process. Even if malware can run without the use of a physical file, it does need to reside in memory in order to operate and is therefore detectable with the help of memory scanning. An example is the GandCrab ransomware, which was reported to have become fileless. The payload DLL is encoded in a string, then decoded and run dynamically via PowerShell. The DLL itself is never dropped on the disk. Using memory scanning, Microsoft 365 Defender can scan the memory of running processes and detect known patterns of the ransomware run from the stealthy DLL.

Memory scanning is a versatile tool. When suspicious APIs or behavior monitoring events are observed at runtime, antivirus capabilities in Microsoft 365 Defender trigger a memory scan. In key points it is more likely to observe (and detect) a payload that has been decoded and may be about to run. This gives Microsoft 365 Defender granular control on which actions are more interesting and may require more attention. Every day, memory scanning helps protect thousands of machines against active high-profile threats like Mimikatz and WannaCry.

### Boot sector protection

With Controlled folder access on Windows 11, Microsoft 365 Defender does not allow write operations to the boot sector, thus closing a dangerous fileless attack vector used by Petya, BadRabbit, and boot kits in general. Boot infection techniques can be suitable for fileless threats because they can allow malware to reside outside of the file system and gain control of the machine before the operating system is loaded. The use of rootkit techniques, like in the defunct Alureon malware (also known as TDSS or TDL-4), can then render the malware invisible and difficult to detect and remove. With Controlled folder access, which is part of Microsoft 365 Defender’s attack surface reduction capabilities, this entire class of infection technique has become a thing of the past.

## Additional resources

- [Automating investigation and response for memory-based attacks](https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/automating-investigation-and-response-for-memory-based-attacks/ba-p/276354)
- [Understanding malware and other threats](/windows/security/threat-protection/intelligence/understanding-malware)
- [Understand and use attack surface reduction](../defender-endpoint/overview-attack-surface-reduction.md)